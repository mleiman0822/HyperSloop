DROP VIEW IF EXISTS hypersloop.slideevent;


CREATE 
    ALGORITHM = UNDEFINED 
    DEFINER = `root`@`localhost` 
    SQL SECURITY DEFINER
VIEW `hypersloop`.`slideevent` AS
    SELECT 
        CONCAT(`userstart`.`EventId`,
                '_',
                `slidestart`.`EventId`,
                '_',
                `slideend`.`EventId`) AS `SlideEventid`,
        `userstart`.`UserId` AS `UserId`,
        `userstart`.`SlideId` AS `SlideId`,
        `userstart`.`DateTime` AS `ScanTime`,
        `slidestart`.`DateTime` AS `StartTime`,
        `slideend`.`DateTime` AS `EndTime`,
        (TIMESTAMPDIFF(MICROSECOND,
            `userstart`.`DateTime`,
            `slidestart`.`DateTime`) / 1000000) AS `Scan Duration`,
        (TIMESTAMPDIFF(MICROSECOND,
            `slidestart`.`DateTime`,
            `slideend`.`DateTime`) / 1000000) AS `Slide Duration`
    FROM
        ((`hypersloop`.`events` `userstart`
        JOIN `hypersloop`.`events` `slidestart` ON (((`userstart`.`SlideId` = `slidestart`.`SlideId`)
            AND (`slidestart`.`DateTime` > `userstart`.`DateTime`)
            AND (TIMESTAMPDIFF(SECOND, `userstart`.`DateTime`, `slidestart`.`DateTime`) < 10)
            AND (`slidestart`.`EventType` = 2)
            AND (`userstart`.`EventType` = 1))))
        JOIN `hypersloop`.`events` `slideend` ON (((`slidestart`.`SlideId` = `slideend`.`SlideId`)
            AND (`slideend`.`DateTime` > `slidestart`.`DateTime`)
            AND (TIMESTAMPDIFF(SECOND, `slidestart`.`DateTime`, `slideend`.`DateTime`) < 10)
            AND (`slideend`.`EventType` = 3))))

